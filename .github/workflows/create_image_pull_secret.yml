
# File: .github/workflows/workflow.yml

on: 
  workflow_dispatch:

name: Create Image Pull Secret

jobs:
  build:
    name: 'Create Image Pull Secret'
    runs-on: ubuntu-latest
    steps:
    - name: 'Create Secret'
      env:
        SSH_KEY: ${{ secrets.EC2_SSH_KEY }}
        EC2_URL: ec2-3-120-174-108.eu-central-1.compute.amazonaws.com
      run: |
        echo "$SSH_KEY" > private_key && chmod 400 private_key
        ssh -o StrictHostKeyChecking=no -i private_key root@$EC2_URL
        kubectl create secret docker-registry image-pull-secret \
          --docker-server=275852535211.dkr.ecr.eu-central-1.amazonaws.com \
          --docker-username=AWS \
          --docker-password=$(aws ecr get-login-password) \
          --namespace=default
